<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Add Donation | Blood Bank Management System</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/616/616494.png" />
  <style>
    body { background: #f8f9fa; }
    .navbar-brand img { height: 32px; margin-right: 8px; }
    .card { max-width: 500px; margin: 40px auto; }
    #map { height: 220px; border-radius: 8px; margin-bottom: 1rem; }
  </style>
</head>
<body>
  <div id="navbar"></div>
  <div class="card shadow">
    <div class="card-body">
      <h3 class="card-title text-center mb-4 text-danger">Add Donation</h3>
      <form id="addDonationForm">
        <div class="mb-3">
          <label for="donorEmail" class="form-label">Donor Email</label>
          <input type="email" class="form-control" id="donorEmail" name="donorEmail" placeholder="Enter donor's email" required>
        </div>
        <div class="mb-3">
          <label for="bloodType" class="form-label">Blood Type</label>
          <select class="form-control" id="bloodType" name="bloodType" required>
            <option value="">Select Blood Type</option>
            <option value="A">A</option>
            <option value="B">B</option>
            <option value="AB">AB</option>
            <option value="O">O</option>
          </select>
        </div>
        <div class="mb-3">
          <label for="expirationDate" class="form-label">Expiration Date</label>
          <input type="date" class="form-control" id="expirationDate" name="expirationDate" required>
        </div>
        <div class="mb-3">
          <label for="city" class="form-label">City</label>
          <select class="form-control" id="city" name="city" required>
            <option value="">Select City</option>
          </select>
        </div>
        <div class="mb-3">
          <label for="virusTestResult" class="form-label">Virus Test Result (optional)</label>
          <select class="form-control" id="virusTestResult" name="virusTestResult">
            <option value="">Pending</option>
            <option value="negative">Negative</option>
            <option value="positive">Positive</option>
          </select>
        </div>
        <button type="submit" class="btn btn-danger w-100">Add Donation</button>
      </form>
      <div id="addDonationMsg" class="mt-3"></div>
    </div>
  </div>
  <footer class="text-center mt-5 text-muted">
    &copy; 2024 Central Blood Bank Management System
  </footer>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>
    $(function() {
      $('#navbar').load('admin-navbar.html');
      // Fetch branch cities for dropdown
      const token = localStorage.getItem('token');
      $.ajax({
        url: '/api/admin/branch-cities',
        method: 'GET',
        headers: { 'Authorization': 'Bearer ' + token },
        success: function(res) {
          const cities = res.cities || [];
          const select = $('#city');
          select.empty();
          select.append('<option value="">Select City</option>');
          cities.forEach(city => {
            select.append(`<option value="${city._id}">${city.name} (${city.latitude}, ${city.longitude})</option>`);
          });
        },
        error: function(xhr) {
          $('#addDonationMsg').html('<div class="alert alert-danger">Failed to load cities.</div>');
        }
      });
    });
  </script>
  <script src="js/admin.js"></script>
</body>
</html> 